# æœ¬åœ°å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½ - å¿«é€ŸæŒ‡å—

## âœ¨ åŠŸèƒ½æ¦‚è¿°

åœ¨ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œè‡ªåŠ¨æ‰§è¡Œæœ¬åœ°å‘½ä»¤ï¼ˆç¼–è¯‘ã€æ‰“åŒ…ã€æµ‹è¯•ç­‰ï¼‰ã€‚

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶

1. **local_command_executor.py** - æœ¬åœ°å‘½ä»¤æ‰§è¡Œå™¨ï¼ˆæ–°å¢ï¼‰
2. **deploy_service.py** - éƒ¨ç½²æœåŠ¡ï¼ˆå·²æ›´æ–°ï¼Œæ”¯æŒæœ¬åœ°å‘½ä»¤ï¼‰
3. **config.yaml** - é…ç½®æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼Œæ·»åŠ ç¤ºä¾‹ï¼‰

## ğŸ“ é…ç½®ç¤ºä¾‹

```yaml
servers:
  - name: æˆ‘çš„æœåŠ¡å™¨
    host: 192.168.1.100
    port: 22
    username: admin
    auth:
      type: ssh_key
      key_path: ~/.ssh/id_rsa

    # ========== æœ¬åœ°å‘½ä»¤é…ç½®ï¼ˆæ–°å¢ï¼‰ ==========
    local_commands:
      # å‰ç«¯é¡¹ç›®
      frontend_admin:
        working_dir: ~/workspace/vue-project
        commands:
          - npm install
          - npm run build:prod
      
      # åç«¯é¡¹ç›®
      backend_api:
        working_dir: ~/workspace/java-project
        commands:
          - mvn clean package -DskipTests

    # ========== ä¸Šä¼ é…ç½® ==========
    upload:
      frontend_admin:
        - local_path: ~/workspace/vue-project/dist/
          remote_path: /var/www/html/
      
      backend_api:
        - local_path: ~/workspace/java-project/target/app.jar
          remote_path: /opt/app/

    # ========== è¿œç¨‹å‘½ä»¤é…ç½® ==========
    commands:
      backend_api:
        - cd /opt/app
        - sh restart.sh
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šäº¤äº’å¼ï¼ˆæ¨èï¼‰

```bash
python3 remote_deploy/deploy_service.py
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ˜¾ç¤ºå¯ç”¨æœåŠ¡å™¨åˆ—è¡¨
2. é€‰æ‹©ä¸Šä¼ ç±»å‹
3. **è‡ªåŠ¨æ‰§è¡Œå¯¹åº”çš„æœ¬åœ°å‘½ä»¤**ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
4. ä¸Šä¼ æ–‡ä»¶
5. æ‰§è¡Œè¿œç¨‹å‘½ä»¤

### æ–¹æ³• 2ï¼šå‘½ä»¤è¡Œå‚æ•°

```bash
# æŒ‡å®šæœåŠ¡å™¨å’Œä¸Šä¼ ç±»å‹
python3 remote_deploy/deploy_service.py -s "æˆ‘çš„æœåŠ¡å™¨" -u frontend_admin

# å®Œæ•´å‚æ•°
python3 remote_deploy/deploy_service.py -s "æˆ‘çš„æœåŠ¡å™¨" -u frontend_admin -g backend_api
```

## ğŸ“Š æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. é€‰æ‹©æœåŠ¡å™¨å’Œä»»åŠ¡                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ‰§è¡Œæœ¬åœ°å‘½ä»¤ â­ æ–°å¢              â”‚
â”‚     - ç¼–è¯‘å‰ç«¯/åç«¯                   â”‚
â”‚     - è¿è¡Œæµ‹è¯•                        â”‚
â”‚     - æ‰“åŒ…æ–‡ä»¶                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. å»ºç«‹ SSH è¿æ¥                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. æ‰§è¡Œè¿œç¨‹å‘½ä»¤                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. æ˜¾ç¤ºéƒ¨ç½²æ‘˜è¦                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ å¸¸è§åœºæ™¯

### åœºæ™¯ 1ï¼šVue3 å‰ç«¯é¡¹ç›®

```yaml
local_commands:
  frontend:
    working_dir: ~/workspace/vue3-admin
    commands:
      - npm install
      - npm run build:prod

upload:
  frontend:
    - local_path: ~/workspace/vue3-admin/dist/
      remote_path: /var/www/html/
      mode: sync
      delete_extra: true
```

### åœºæ™¯ 2ï¼šSpring Boot åç«¯é¡¹ç›®

```yaml
local_commands:
  backend:
    working_dir: ~/workspace/springboot-app
    commands:
      - mvn clean package -DskipTests

upload:
  backend:
    - local_path: ~/workspace/springboot-app/target/app.jar
      remote_path: /opt/app/

commands:
  backend:
    - cd /opt/app
    - sh restart.sh
```

### åœºæ™¯ 3ï¼šå…¨æ ˆé¡¹ç›®ï¼ˆå‰åç«¯ä¸€èµ·éƒ¨ç½²ï¼‰

```yaml
local_commands:
  fullstack:
    working_dir: ~/workspace/my-project
    commands:
      - echo "ç¼–è¯‘å‰ç«¯..."
      - cd frontend && npm run build && cd ..
      - echo "ç¼–è¯‘åç«¯..."
      - cd backend && mvn package && cd ..
      - echo "æ‰“åŒ…å®Œæˆï¼"

upload:
  fullstack:
    - local_path: ~/workspace/my-project/frontend/dist/
      remote_path: /var/www/html/
    - local_path: ~/workspace/my-project/backend/target/app.jar
      remote_path: /opt/app/
```

## âš™ï¸ é…ç½®é€‰é¡¹

| é…ç½®é¡¹ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `working_dir` | string | å¦ | å½“å‰ç›®å½• | å‘½ä»¤æ‰§è¡Œçš„å·¥ä½œç›®å½• |
| `stop_on_error` | boolean | å¦ | true | é‡åˆ°é”™è¯¯æ˜¯å¦åœæ­¢ |
| `commands` | list | æ˜¯ | - | è¦æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ |

## âœ… ä¼˜åŠ¿

1. **è‡ªåŠ¨åŒ–**ï¼šæ— éœ€æ‰‹åŠ¨ç¼–è¯‘ï¼Œä¸€é”®å®Œæˆ
2. **å¯é æ€§**ï¼šç¼–è¯‘å¤±è´¥ä¼šè‡ªåŠ¨åœæ­¢éƒ¨ç½²
3. **çµæ´»æ€§**ï¼šæ”¯æŒä»»æ„å‘½ä»¤å’Œå·¥ä½œç›®å½•
4. **å¯è§†åŒ–**ï¼šå®æ—¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹å’Œç»“æœ
5. **æ˜“ç»´æŠ¤**ï¼šé…ç½®æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹

## ğŸ“š æ›´å¤šèµ„æº

- **è¯¦ç»†æ–‡æ¡£**ï¼š`LOCAL_COMMANDS_README.md`
- **é…ç½®ç¤ºä¾‹**ï¼š`local_commands_example.yaml`
- **æºä»£ç **ï¼š`local_command_executor.py`

## ğŸ”§ å®‰è£…ä¾èµ–

å¦‚æœæç¤ºç¼ºå°‘ä¾èµ–ï¼Œè¯·è¿è¡Œï¼š

```bash
pip3 install -r requirements.txt
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
2. å·¥ä½œç›®å½•æ˜¯å¦å­˜åœ¨
3. å‘½ä»¤æ˜¯å¦å¯ç”¨ï¼ˆå¦‚ npmã€mvn ç­‰ï¼‰
4. æ—¥å¿—è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯

