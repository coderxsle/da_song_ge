# 远程服务器配置文件示例
# 请根据实际情况修改此文件

license_key: 8k9D7s857
servers:
  # ======================================================================================================
  #                                              领航不良资产测试                                               
  - name: 领航不良资产测试
    host: 123.121.121.129
    port: 22
    username: root
    auth:
      type: ssh_key
      key_path: ~/.ssh/id_rsa
      password: sd3Dasd3465SD%$%#!112g
    # 本地命令（在上传文件之前执行）
    # 可以为每个上传类型配置不同的本地命令
    local_commands:
      # 后端项目编译命令
      backend_api:
        working_dir: ~/workspace/ling_hang/ling_hang_server
        commands:
          - mvn clean package -Dmaven.test.skip=true
      # 前端项目编译命令
      frontend_admin:
        working_dir: ~/workspace/ling_hang/ling_hang_admin  # 工作目录（可选）
        commands:
          - npm install
          - npm run build:prod
          - tar  --no-xattrs -czf dist-prod.tar.gz -C dist-prod .
    # 文件上传可以自定义项目，例如：backend、frontend、admin、、static、worker等
    upload:
      # 后端接口服务
      backend_api:
        - local_path: ~/Desktop/未命名文件夹/
          remote_path: /home/admin/web_projects/dccw/server-api/

        - local_path: ~/Desktop/test.sh
          remote_path: /home/admin/web_projects/dccw/server-api/bin/
      
      # 前端后台管理页面
      frontend_admin: 
        - local_path: ~/workspace/ling_hang/ling_hang_admin/dist-prod.tar.gz
          remote_path: /home/admin/web_projects/dccw/server-backui/
          mode: sync   # 或者使用 copy ，如果使用 sync 则服务器完全同步本地目录。
          delete_extra: true # 设置为 true 可以删除服务器该目录上多余的旧文件，它只在 mode: sync 时才有意义。

      # 前端静态页面  
      frontend_static: 
        - local_path: ~/workspace/ling_hang/ling_hang_admin/dist-prod/
          remote_path: /home/admin/web_projects/dccw/server-backui/

    # 远程服务器需要执行的命令
    commands:
      frontend_admin: # 前端命令
        - cd /home/admin/web_projects/dccw/server-backui/
        - tar -xzf dist-prod.tar.gz
        # - rm dist-prod.tar.gz  # 可选：删除压缩包
        - mv dist-prod.tar.gz dist-prod-$(date +%m%d%H%M).tar.gz # 1. 给压缩包加上当前时间后缀防止覆盖
        - echo -e "\033[33m✓ 部署完成，压缩包已保存为 dist-prod-$(date +%m%d%H%M).tar.gz\033[0m"
      backend_api: # 后端命令
        - cd /home/admin/web_projects/dccw/server-api/bin
        - sh test.sh
  # ======================================================================================================


  # ======================================================================================================
  #                                              示例服务器 2                                               
  # ======================================================================================================
  #                                              示例服务器 2                                               
  - name: 示例服务器 2
    host: 123.121.121.129
    port: 22
    username: root
    auth:
      type: ssh_key
      key_path: ~/.ssh/id_rsa
      password: sd3Dasd3465SD%$%#!112g
    # 本地命令（在上传文件之前执行）
    # 可以为每个上传类型配置不同的本地命令
    local_commands:
      # 后端项目编译命令
      backend_api:
        working_dir: ~/workspace/ling_hang/ling_hang_server
        commands:
          - mvn clean package -Dmaven.test.skip=true
      # 前端项目编译命令
      frontend_admin:
        working_dir: ~/workspace/ling_hang/ling_hang_admin  # 工作目录（可选）
        commands:
          - npm install
          - npm run build:prod
          - tar  --no-xattrs -czf dist-prod.tar.gz -C dist-prod .
    # 文件上传可以自定义项目，例如：backend、frontend、admin、、static、worker等
    upload:
      # 后端接口服务
      backend_api:
        - local_path: ~/Desktop/未命名文件夹/
          remote_path: /home/admin/web_projects/dccw/server-api/

        - local_path: ~/Desktop/test.sh
          remote_path: /home/admin/web_projects/dccw/server-api/bin/
      
      # 前端后台管理页面
      frontend_admin: 
        - local_path: ~/workspace/ling_hang/ling_hang_admin/dist-prod.tar.gz
          remote_path: /home/admin/web_projects/dccw/server-backui/
          mode: sync   # 或者使用 copy ，如果使用 sync 则服务器完全同步本地目录。
          delete_extra: true # 设置为 true 可以删除服务器该目录上多余的旧文件，它只在 mode: sync 时才有意义。

      # 前端静态页面  
      frontend_static: 
        - local_path: ~/workspace/ling_hang/ling_hang_admin/dist-prod/
          remote_path: /home/admin/web_projects/dccw/server-backui/

    # 远程服务器需要执行的命令
    commands:
      frontend_admin: # 前端命令
        - cd /home/admin/web_projects/dccw/server-backui/
        - tar -xzf dist-prod.tar.gz
        # - rm dist-prod.tar.gz  # 可选：删除压缩包
        - mv dist-prod.tar.gz dist-prod-$(date +%m%d%H%M).tar.gz # 1. 给压缩包加上当前时间后缀防止覆盖
        - echo -e "\033[33m✓ 部署完成，压缩包已保存为 dist-prod-$(date +%m%d%H%M).tar.gz\033[0m"
      backend_api: # 后端命令
        - cd /home/admin/web_projects/dccw/server-api/bin
        - sh test.sh
  # ======================================================================================================

