# è¿œç¨‹æœåŠ¡å™¨ç®¡ç†ä¸è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

ä¸€ä¸ªå¼ºå¤§çš„ Python å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç†å¤šå°è¿œç¨‹æœåŠ¡å™¨çš„æ–‡ä»¶ä¸Šä¼ å’Œå‘½ä»¤æ‰§è¡Œï¼Œæ”¯æŒäº¤äº’å¼æ“ä½œå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **å¤šæœåŠ¡å™¨ç®¡ç†**: ç»Ÿä¸€ç®¡ç†å¤šä¸ªé¡¹ç›®çš„å¤šå°æœåŠ¡å™¨
- ğŸ“¤ **çµæ´»çš„æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒ syncï¼ˆåŒæ­¥ï¼‰å’Œ copyï¼ˆå¤åˆ¶ï¼‰ä¸¤ç§æ¨¡å¼
- ğŸ¯ **åˆ†ç±»ä¸Šä¼ ç®¡ç†**: æ”¯æŒå‰ç«¯ã€åç«¯ç­‰ä¸åŒç±»å‹çš„ä¸Šä¼ ä»»åŠ¡
- ğŸ’» **è¿œç¨‹å‘½ä»¤æ‰§è¡Œ**: æŒ‰é¡ºåºæ‰§è¡Œå‘½ä»¤ç»„ï¼Œè‡ªåŠ¨å¤„ç†å¤±è´¥æƒ…å†µ
- ğŸ¨ **å‹å¥½çš„ç”¨æˆ·ç•Œé¢**: æ”¯æŒäº¤äº’å¼é€‰æ‹©å’Œå‘½ä»¤è¡Œå‚æ•°ä¸¤ç§æ–¹å¼
- ğŸ“Š **å®æ—¶è¿›åº¦æ˜¾ç¤º**: æ–‡ä»¶ä¸Šä¼ è¿›åº¦å®æ—¶æ˜¾ç¤º
- ğŸ”’ **å®‰å…¨è®¤è¯**: æ”¯æŒ SSH å¯†é’¥è®¤è¯
- ğŸ§ª **æ¨¡æ‹Ÿæ‰§è¡Œ**: æ”¯æŒ dry-run æ¨¡å¼ï¼Œé¢„è§ˆæ‰§è¡Œè®¡åˆ’

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.12+
- SSH è®¿é—®æƒé™åˆ°ç›®æ ‡æœåŠ¡å™¨
- SSH å¯†é’¥æ–‡ä»¶ï¼ˆæ¨èï¼‰æˆ–å¯†ç 

## ğŸ”§ å®‰è£…

### 1. å…‹éš†é¡¹ç›®

```bash
cd /path/to/PythonProject
```

### 2. å®‰è£…ä¾èµ–

```bash
uv pip install -r requirements.txt
# æˆ–æ¨èä½¿ç”¨ç°ä»£ Python åŒ…ç®¡ç†çš„å‘½ä»¤ï¼ˆå¦‚æœä½¿ç”¨ pyproject.tomlï¼‰:
uv pip install
```

### 3. é…ç½®æœåŠ¡å™¨

ç¼–è¾‘ `scripts/config.yaml` æ–‡ä»¶ï¼Œé…ç½®æ‚¨çš„æœåŠ¡å™¨ä¿¡æ¯ï¼š

```yaml
servers:
  - name: æˆ‘çš„æœåŠ¡å™¨
    host: 192.168.1.10
    port: 22
    username: deploy
    auth:
      type: ssh_key
      key_path: ~/.ssh/id_rsa
    upload:
      frontend_admin:
        - local_path: ~/workspace/project/dist/
          remote_path: /var/www/html/
          mode: sync
          delete_extra: true
    commands:
      restart_service:
        - systemctl restart nginx
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### äº¤äº’å¼æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
cd scripts
uv python remote_deploy.py
```

ç¨‹åºä¼šå¼•å¯¼æ‚¨ï¼š
1. é€‰æ‹©æœåŠ¡å™¨
2. é€‰æ‹©ä¸Šä¼ ç±»å‹
3. é€‰æ‹©å‘½ä»¤ç»„
4. ç¡®è®¤å¹¶æ‰§è¡Œ

### å‘½ä»¤è¡Œæ¨¡å¼

```bash
# æŒ‡å®šæœåŠ¡å™¨
uv python remote_deploy.py -s "æˆ‘çš„æœåŠ¡å™¨"

# æŒ‡å®šä¸Šä¼ ç±»å‹
uv python remote_deploy.py -s "æˆ‘çš„æœåŠ¡å™¨" -u frontend_admin

# æŒ‡å®šå‘½ä»¤ç»„
uv python remote_deploy.py -s "æˆ‘çš„æœåŠ¡å™¨" -g restart_service

# å®Œæ•´å‚æ•°
uv python remote_deploy.py -c config.yaml -s "æˆ‘çš„æœåŠ¡å™¨" -u frontend_admin -g restart_service

# æ¨¡æ‹Ÿæ‰§è¡Œï¼ˆä¸å®é™…æ“ä½œï¼‰
uv python remote_deploy.py -s "æˆ‘çš„æœåŠ¡å™¨" -u frontend_admin -d
```

## ğŸ“– é…ç½®æ–‡ä»¶è¯´æ˜

### æœåŠ¡å™¨é…ç½®

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| name | string | æ˜¯ | æœåŠ¡å™¨åç§°ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ |
| host | string | æ˜¯ | æœåŠ¡å™¨ IP åœ°å€ |
| port | int | æ˜¯ | SSH ç«¯å£ |
| username | string | æ˜¯ | SSH ç”¨æˆ·å |
| auth | object | æ˜¯ | è®¤è¯é…ç½® |
| upload | object | å¦ | ä¸Šä¼ ä»»åŠ¡é…ç½® |
| commands | object | å¦ | è¿œç¨‹å‘½ä»¤é…ç½® |

### è®¤è¯é…ç½®

#### æ–¹å¼ 1ï¼šSSH å¯†é’¥è®¤è¯ï¼ˆæ¨èï¼‰

```yaml
auth:
  type: ssh_key
  key_path: ~/.ssh/id_rsa
  password: your_password_here  # å¯é€‰ï¼šSSH å¯†ç 
```

**è¯´æ˜**ï¼š
- `key_path`ï¼šSSH ç§é’¥æ–‡ä»¶è·¯å¾„ï¼ˆæ”¯æŒ `~` å±•å¼€ï¼‰
- `password`ï¼šå¯é€‰å­—æ®µ
  - å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­æä¾›ï¼Œå°†ç›´æ¥ä½¿ç”¨
  - å¦‚æœä¸æä¾›ï¼Œè¿æ¥æ—¶ä¼šæç¤ºæ‚¨è¾“å…¥å¯†ç 

#### æ–¹å¼ 2ï¼šå¯†ç è®¤è¯

```yaml
auth:
  type: password
  password: your_password_here  # å¯é€‰ï¼šSSH å¯†ç 
```

**è¯´æ˜**ï¼š
- `password`ï¼šå¯é€‰å­—æ®µ
  - å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­æä¾›ï¼Œå°†ç›´æ¥ä½¿ç”¨
  - å¦‚æœä¸æä¾›ï¼Œè¿æ¥æ—¶ä¼šæç¤ºæ‚¨è¾“å…¥å¯†ç 

### ä¸Šä¼ é…ç½®

```yaml
upload:
  frontend_admin:  # ä¸Šä¼ ç±»å‹åç§°ï¼ˆè‡ªå®šä¹‰ï¼‰
    - local_path: ~/workspace/project/dist/  # æœ¬åœ°è·¯å¾„
      remote_path: /var/www/html/            # è¿œç¨‹è·¯å¾„
      mode: sync                              # ä¸Šä¼ æ¨¡å¼ï¼šsync æˆ– copy
      delete_extra: true                      # æ˜¯å¦åˆ é™¤å¤šä½™æ–‡ä»¶ï¼ˆä»… sync æ¨¡å¼ï¼‰
```

**ä¸Šä¼ æ¨¡å¼è¯´æ˜**ï¼š

- **sync æ¨¡å¼**: åŒæ­¥æœ¬åœ°å’Œè¿œç¨‹ç›®å½•ï¼Œè¿œç¨‹ç›®å½•å®Œå…¨åŒæ­¥æœ¬åœ°ç›®å½•
  - ä¸Šä¼ æœ¬åœ°æ–°å¢æˆ–ä¿®æ”¹çš„æ–‡ä»¶
  - å¦‚æœ `delete_extra: true`ï¼Œåˆ é™¤è¿œç¨‹å¤šä½™çš„æ–‡ä»¶
  - é€‚ç”¨åœºæ™¯ï¼šå‰ç«¯é™æ€èµ„æºéƒ¨ç½²

- **copy æ¨¡å¼**: ä»…ä¸Šä¼ æœ¬åœ°æ–‡ä»¶ï¼Œä¸åˆ é™¤è¿œç¨‹æ–‡ä»¶
  - åªä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹
  - ä¿ç•™è¿œç¨‹å·²å­˜åœ¨çš„å…¶ä»–æ–‡ä»¶
  - é€‚ç”¨åœºæ™¯ï¼šåç«¯ JAR åŒ…éƒ¨ç½²ã€é…ç½®æ–‡ä»¶ä¸Šä¼ 

### å‘½ä»¤é…ç½®

```yaml
commands:
  restart_service:  # å‘½ä»¤ç»„åç§°ï¼ˆè‡ªå®šä¹‰ï¼‰
    - cd /var/www/html
    - systemctl restart nginx
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šéƒ¨ç½²å‰ç«¯é¡¹ç›®

```yaml
servers:
  - name: å‰ç«¯æœåŠ¡å™¨
    host: 192.168.1.100
    port: 22
    username: deploy
    auth:
      type: ssh_key
      key_path: ~/.ssh/id_rsa
      password: your_password  # å¯é€‰ï¼šç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­æä¾›å¯†ç 
    upload:
      frontend_dist:
        - local_path: ~/workspace/my-vue-app/dist/
          remote_path: /var/www/html/
          mode: sync
          delete_extra: true
    commands:
      reload_nginx:
        - nginx -t
        - systemctl reload nginx
```

æ‰§è¡Œï¼š
```bash
python remote_deploy.py -s "å‰ç«¯æœåŠ¡å™¨" -u frontend_dist -g reload_nginx
```

### ç¤ºä¾‹ 2ï¼šéƒ¨ç½²åç«¯ Spring Boot é¡¹ç›®

```yaml
servers:
  - name: åç«¯æœåŠ¡å™¨
    host: 192.168.1.200
    port: 22
    username: deploy
    auth:
      type: password
      password: your_password  # å¯†ç è®¤è¯å¿…é¡»æä¾›å¯†ç 
    upload:
      backend_jar:
        - local_path: ~/workspace/my-spring-app/target/app.jar
          remote_path: /opt/app/
        - local_path: ~/workspace/my-spring-app/scripts/start.sh
          remote_path: /opt/app/bin/
    commands:
      restart_app:
        - cd /opt/app/bin
        - sh stop.sh
        - sh start.sh
```

æ‰§è¡Œï¼š
```bash
python remote_deploy.py -s "åç«¯æœåŠ¡å™¨" -u backend_jar -g restart_app
```

## ğŸ¯ å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| --config | -c | æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ | -c config.yaml |
| --server | -s | æŒ‡å®šæœåŠ¡å™¨åç§° | -s "æˆ‘çš„æœåŠ¡å™¨" |
| --upload-type | -u | æŒ‡å®šä¸Šä¼ ç±»å‹ | -u frontend_admin |
| --command-group | -g | æŒ‡å®šå‘½ä»¤ç»„ | -g restart_service |
| --dry-run | -d | æ¨¡æ‹Ÿæ‰§è¡Œï¼ˆä¸å®é™…æ“ä½œï¼‰ | -d |
| --help | -h | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | -h |
| --version | -v | æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ | -v |

## ğŸ“ å¸¸è§é—®é¢˜

### Q: SSH è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æœåŠ¡å™¨ IPã€ç«¯å£ã€ç”¨æˆ·åæ˜¯å¦æ­£ç¡®
2. SSH å¯†é’¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š`ls -la ~/.ssh/id_rsa`
3. å¯†é’¥æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®ï¼š`chmod 600 ~/.ssh/id_rsa`
4. æ˜¯å¦å¯ä»¥æ‰‹åŠ¨ SSH è¿æ¥ï¼š`ssh user@host -p port`

### Q: æ–‡ä»¶ä¸Šä¼ å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æœ¬åœ°æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. è¿œç¨‹ç›®å½•æ˜¯å¦æœ‰å†™æƒé™
3. ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
4. ç½‘ç»œè¿æ¥æ˜¯å¦ç¨³å®š

### Q: å‘½ä»¤æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. å‘½ä»¤æ˜¯å¦æ­£ç¡®
2. è¿œç¨‹ç¯å¢ƒæ˜¯å¦æ»¡è¶³è¦æ±‚ï¼ˆå¦‚ Javaã€Node.js ç­‰ï¼‰
3. ç”¨æˆ·æ˜¯å¦æœ‰æ‰§è¡Œæƒé™
4. æŸ¥çœ‹é”™è¯¯è¾“å‡ºï¼Œæ ¹æ®æç¤ºè°ƒæ•´

### Q: sync æ¨¡å¼çš„ delete_extra ä¼šåˆ é™¤å“ªäº›æ–‡ä»¶ï¼Ÿ

**A**: 
- `delete_extra: true` ä¼šåˆ é™¤è¿œç¨‹ç›®å½•ä¸­å­˜åœ¨ä½†æœ¬åœ°ç›®å½•ä¸­ä¸å­˜åœ¨çš„æ–‡ä»¶
- è¯·è°¨æ…ä½¿ç”¨ï¼Œå»ºè®®å…ˆç”¨ `--dry-run` æ¨¡å¼é¢„è§ˆ
- é€‚ç”¨äºå‰ç«¯é™æ€èµ„æºéƒ¨ç½²ï¼Œç¡®ä¿è¿œç¨‹ç›®å½•ä¸æœ¬åœ°å®Œå…¨ä¸€è‡´

### Q: å¦‚ä½•é…ç½® SSH å¯†ç ï¼Ÿ

**A**: æœ‰ä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼ 1ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­ç›´æ¥é…ç½®ï¼ˆæ¨èï¼‰**
```yaml
auth:
  type: ssh_key  # æˆ– password
  key_path: ~/.ssh/id_rsa  # ssh_key ç±»å‹éœ€è¦
  password: your_password_here  # ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­æä¾›å¯†ç 
```

**æ–¹å¼ 2ï¼šä¸é…ç½®å¯†ç ï¼Œè¿è¡Œæ—¶è¾“å…¥**
```yaml
auth:
  type: ssh_key
  key_path: ~/.ssh/id_rsa
  # ä¸é…ç½® password å­—æ®µ
```

è¿è¡Œæ—¶ä¼šæç¤ºæ‚¨è¾“å…¥å¯†ç ï¼š
```
è¯·è¾“å…¥æœåŠ¡å™¨ 'æˆ‘çš„æœåŠ¡å™¨' çš„å¯†ç :
å¯†ç : ********
```

### Q: å¯ä»¥åŒæ—¶éƒ¨ç½²å¤šå°æœåŠ¡å™¨å—ï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬æ¯æ¬¡åªèƒ½éƒ¨ç½²ä¸€å°æœåŠ¡å™¨ã€‚å¦‚éœ€éƒ¨ç½²å¤šå°ï¼Œå¯ä»¥ç¼–å†™è„šæœ¬å¾ªç¯è°ƒç”¨ï¼š
```bash
for server in "æœåŠ¡å™¨1" "æœåŠ¡å™¨2" "æœåŠ¡å™¨3"; do
    python remote_deploy.py -s "$server" -u frontend_admin -g restart_service
done
```

## ğŸ” å®‰å…¨å»ºè®®

1. **SSH å¯†é’¥æƒé™**: ç¡®ä¿ç§é’¥æ–‡ä»¶æƒé™ä¸º 600
   ```bash
   chmod 600 ~/.ssh/id_rsa
   ```

2. **é…ç½®æ–‡ä»¶æƒé™**: ä¿æŠ¤é…ç½®æ–‡ä»¶ï¼Œé¿å…æ³„éœ²æœåŠ¡å™¨ä¿¡æ¯
   ```bash
   chmod 600 config.yaml
   ```

3. **ä¸è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å­˜å‚¨å¯†ç **: ä½¿ç”¨ SSH å¯†é’¥è®¤è¯

4. **è°¨æ…ä½¿ç”¨ delete_extra**: å…ˆç”¨ dry-run æ¨¡å¼é¢„è§ˆ

5. **å¤‡ä»½é‡è¦æ–‡ä»¶**: éƒ¨ç½²å‰å¤‡ä»½è¿œç¨‹æœåŠ¡å™¨çš„é‡è¦æ–‡ä»¶

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
PythonProject/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ remote_deploy.py          # ä¸»å…¥å£è„šæœ¬
â”‚   â”œâ”€â”€ config.yaml                # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.md            # éœ€æ±‚æ–‡æ¡£
â”‚   â”œâ”€â”€ design.md                  # è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ tasks.md                   # ä»»åŠ¡æ¸…å•
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ssh_client.py              # SSH å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ log_utils.py               # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ path_utils.py              # è·¯å¾„å·¥å…·
â”œâ”€â”€ remote_deploy/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config_manager.py          # é…ç½®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ deploy_service.py          # éƒ¨ç½²æœåŠ¡
â”‚   â”œâ”€â”€ file_uploader.py           # æ–‡ä»¶ä¸Šä¼ å™¨
â”‚   â””â”€â”€ command_executor.py        # å‘½ä»¤æ‰§è¡Œå™¨
â”œâ”€â”€ requirements.txt               # ä¾èµ–åŒ…
â””â”€â”€ README.md                      # ä½¿ç”¨æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤è€… coderxslee@qq.comã€‚

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

